<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="img/logo-bg.png" type="image/png">
  <title>Bank Soal ICT - ICT LAB</title>
  <link rel="stylesheet" href="css/fa-brands.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css">
  <script src="js/login-manager.js" defer></script>
  <!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    /* Navbar styles - Match catalog navbar exactly */
    .catalog-navbar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      z-index: 8;
      display: flex;
      align-items: center;
      padding: 15px 0; /* Match catalog navbar padding */
    }

    .catalog-navbar-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
    }

    .catalog-navbar-logo img {
      height: 40px; /* Match catalog navbar logo height */
      width: auto;
      object-fit: contain;
    }

    .catalog-navbar-menu {
      display: flex;
      gap: 40px;
    }

    .catalog-navbar-item {
      text-decoration: none;
      color: #1a1a1a;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      font-size: 1rem; /* Match catalog navbar font size */
      transition: color 0.3s ease;
      position: relative;
    }

    .catalog-navbar-item:hover {
      color: #666;
    }

    .catalog-navbar-item::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background: #1a1a1a;
      transition: width 0.3s ease;
    }

    .catalog-navbar-item:hover::after {
      width: 100%;
    }

    /* User Dropdown Menu Styles */
    .user-dropdown-menu,
    .simple-logout-menu {
      position: fixed;
      background: white;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 0, 0, 0.1);
      min-width: 250px;
      z-index: 10000;
      animation: fadeInUp 0.2s ease-out;
      overflow: hidden;
      font-family: 'Inter', sans-serif;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-info {
      padding: 20px;
      display: flex;
      gap: 12px;
      align-items: center;
      background: #f8f9fa;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .user-details {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      color: #1a1a1a;
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .user-email {
      font-size: 0.8rem;
      color: #666;
      margin: 2px 0;
    }

    .login-method {
      font-size: 0.75rem;
      color: #999;
      background: rgba(66, 133, 244, 0.1);
      padding: 4px 8px;
      border-radius: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
      display: inline-block;
    }

    .menu-divider {
      height: 1px;
      background: #e0e0e0;
    }

    .menu-item {
      width: 100%;
      padding: 12px 20px;
      border: none;
      background: white;
      text-align: left;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
      color: #666;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }

    .menu-item:hover {
      background: #f0f0f0;
      color: #1a1a1a;
    }

    .menu-item i {
      width: 16px;
      text-align: center;
    }

    /* Prevent multiple redirects */
    body.redirecting {
      pointer-events: none;
      opacity: 0.7;
    }
    
    body.redirecting::after {
      content: "Redirecting to login...";
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 20px 40px;
      border-radius: 10px;
      z-index: 10002;
      font-family: 'Inter', sans-serif;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: rgba(240,235,222,255); /* Match catalog background */
      margin: 0;
      padding: 85px 20px 20px; /* Adjusted top padding for taller navbar */
      min-height: 100vh;
    }
    
    .bank-soal-container {
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .bank-soal-header {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
      padding: 40px;
      margin-bottom: 30px;
      text-align: center;
    }
    
    .bank-soal-header h1 {
      margin: 0 0 15px;
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-family: 'Zen Old Mincho', serif;
    }
    
    .bank-soal-header p {
      margin: 0;
      color: #666;
      font-size: 1.1rem;
      line-height: 1.6;
    }
    
    /* Search and Filter Section */
    .search-filter-section {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 30px;
    }
    
    .search-bar {
      position: relative;
      margin-bottom: 25px;
    }
    
    .search-bar i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #666;
      font-size: 1.1rem;
    }
    
    .search-bar input {
      width: 100%;
      padding: 15px 15px 15px 45px;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      font-size: 1rem;
      font-family: 'Inter', sans-serif;
      transition: border-color 0.3s ease;
    }
    
    .search-bar input:focus {
      outline: none;
      border-color: #4285F4;
    }
    
    .filter-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      align-items: end;
    }
    
    .filter-item {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .filter-item label {
      font-weight: 500;
      color: #1a1a1a;
      font-size: 0.9rem;
    }
    
    .filter-item select {
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 0.9rem;
      font-family: 'Inter', sans-serif;
      background: white;
      transition: border-color 0.3s ease;
    }
    
    .filter-item select:focus {
      outline: none;
      border-color: #4285F4;
    }
    
    .reset-filter-btn {
      padding: 12px 20px;
      background: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      color: #666;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .reset-filter-btn:hover {
      background: #e9ecef;
      color: #1a1a1a;
    }
    
    /* Cards Section */
    .cards-section {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .cards-header {
      padding: 25px 30px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
    }
    
    .cards-header h3 {
      margin: 0;
      color: #1a1a1a;
      font-size: 1.3rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .cards-stats {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .cards-container {
      padding: 30px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
    }
    
    .soal-card {
      background: white;
      border: 2px solid #f0f0f0;
      border-radius: 15px;
      padding: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }
    
    .soal-card:hover {
      border-color: #4285F4;
      box-shadow: 0 10px 30px rgba(66, 133, 244, 0.15);
      transform: translateY(-5px);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    
    .card-icon {
      width: 45px;
      height: 45px;
      background: linear-gradient(135deg, #4285F4 0%, #34A853 100%);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }
    
    .card-title {
      flex: 1;
    }
    
    .card-title h4 {
      margin: 0 0 5px;
      color: #1a1a1a;
      font-size: 1.1rem;
      font-weight: 600;
      line-height: 1.3;
    }
    
    .card-subtitle {
      margin: 0;
      color: #666;
      font-size: 0.85rem;
    }
    
    .card-selectors {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .selector-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    
    .selector-group label {
      font-size: 0.8rem;
      font-weight: 500;
      color: #666;
    }
    
    .selector-group select {
      padding: 10px 12px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 0.85rem;
      font-family: 'Inter', sans-serif;
      background: white;
      transition: border-color 0.3s ease;
    }
    
    .selector-group select:focus {
      outline: none;
      border-color: #4285F4;
    }
    
    .card-actions {
      display: flex;
      gap: 10px;
    }
    
    .card-preview-btn, .card-download-btn {
      flex: 1;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-family: 'Inter', sans-serif;
    }
    
    .card-preview-btn {
      background: #e3f2fd;
      color: #1976d2;
      border: 2px solid transparent;
    }
    
    .card-preview-btn:hover {
      background: #bbdefb;
      border-color: #1976d2;
    }
    
    .card-download-btn {
      background: #e8f5e8;
      color: #2e7d32;
      border: 2px solid transparent;
    }
    
    .card-download-btn:hover {
      background: #c8e6c9;
      border-color: #2e7d32;
    }
    
    .card-preview-btn:disabled, .card-download-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .card-preview-btn:disabled:hover, .card-download-btn:disabled:hover {
      background: #e3f2fd;
      border-color: transparent;
    }
    
    .card-download-btn:disabled:hover {
      background: #e8f5e8;
      border-color: transparent;
    }
    
    .no-soal-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    
    .no-soal-message i {
      font-size: 3rem;
      margin-bottom: 15px;
      display: block;
      color: #ddd;
    }
    
    .no-soal-message h4 {
      margin: 0 0 10px;
      font-size: 1.2rem;
      font-weight: 500;
    }
    
    .no-soal-message p {
      margin: 0;
      font-size: 0.9rem;
    }
    
    /* Pagination Section */
    .pagination-section {
      padding: 30px;
      border-top: 1px solid #e9ecef;
      background: #f8f9fa;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }
    
    .pagination-info {
      color: #666;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .pagination-btn {
      padding: 10px 16px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      color: #666;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.9rem;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background: #4285F4;
      color: white;
      border-color: #4285F4;
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: #f8f9fa;
    }
    
    .pagination-numbers {
      display: flex;
      gap: 5px;
    }
    
    .pagination-number {
      width: 40px;
      height: 40px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      background: white;
      color: #666;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .pagination-number:hover {
      background: #e3f2fd;
      border-color: #4285F4;
      color: #4285F4;
    }
    
    .pagination-number.active {
      background: #4285F4;
      border-color: #4285F4;
      color: white;
    }
    
    .pagination-ellipsis {
      color: #999;
      font-weight: 500;
      padding: 0 5px;
    }
    
    /* Preview Modal */
    .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 10001;
      animation: fadeIn 0.3s ease;
    }
    
    .preview-modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    
    .preview-header {
      padding: 20px 30px;
      border-bottom: 1px solid #e9ecef;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #f8f9fa;
    }
    
    .preview-header h3 {
      margin: 0;
      color: #1a1a1a;
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .close-preview {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: #666;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
      transition: color 0.3s ease;
    }
    
    .close-preview:hover {
      color: #1a1a1a;
    }
    
    .preview-body {
      padding: 20px;
      text-align: center;
      max-height: 70vh;
      overflow: auto;
    }
    
    .preview-body img {
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    
    .preview-footer {
      padding: 20px 30px;
      border-top: 1px solid #e9ecef;
      text-align: center;
      background: #f8f9fa;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* SweetAlert Custom Styling */
    .swal-popup {
      font-family: 'Inter', sans-serif !important;
      border-radius: 15px !important;
    }
    
    .swal-title {
      font-family: 'Inter', sans-serif !important;
      font-weight: 600 !important;
      color: #1a1a1a !important;
    }
    
    .swal-content {
      font-family: 'Inter', sans-serif !important;
      color: #666 !important;
    }
    
    @media (max-width: 768px) {
      .bank-soal-container {
        padding: 20px 10px;
      }
      
      .search-filter-section {
        padding: 20px;
      }
      
      .filter-section {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .cards-header {
        padding: 20px;
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }
      
      .cards-container {
        padding: 20px;
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .soal-card {
        padding: 20px;
      }
      
      .card-selectors {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .card-actions {
        flex-direction: column;
        gap: 8px;
      }
      
      .preview-modal-content {
        max-width: 95vw;
        max-height: 95vh;
        margin: 10px;
      }
      
      .preview-header {
        padding: 15px 20px;
      }
      
      .preview-body {
        padding: 15px;
      }
      
      .preview-footer {
        padding: 15px 20px;
      }
      
      .pagination-section {
        padding: 20px;
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
      }
      
      .pagination-controls {
        justify-content: center;
        gap: 10px;
      }
      
      .pagination-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
      }
      
      .pagination-number {
        width: 35px;
        height: 35px;
        font-size: 0.85rem;
      }
    }
    
    @media (max-width: 480px) {
      .catalog-navbar-container {
        padding: 0 20px;
      }
      
      .catalog-navbar-menu {
        gap: 20px;
      }
      
      .bank-soal-header h1 {
        font-size: 2rem;
      }
      
      .bank-soal-header p {
        font-size: 1rem;
      }
      
      .cards-container {
        grid-template-columns: 1fr;
        padding: 15px;
      }
      
      .soal-card {
        padding: 15px;
      }
      
      .card-header {
        gap: 10px;
      }
      
      .card-icon {
        width: 40px;
        height: 40px;
        font-size: 1rem;
      }
      
      .card-title h4 {
        font-size: 1rem;
      }
    }
  </style>
</head>

<body>
  <!-- Simplified Navbar -->
  <nav class="catalog-navbar">
    <div class="catalog-navbar-container">
      <div class="catalog-navbar-logo">
        <img src="img/logo-bg.png" alt="ICT Lab Logo" loading="lazy">
      </div>
      <div class="catalog-navbar-menu">
        <a href="index.html" class="catalog-navbar-item">Home</a>
        <a href="catalog.html" class="catalog-navbar-item">Catalog</a>
        <a href="login.html" class="catalog-navbar-item">Login</a>
      </div>
    </div>
  </nav>

  <div class="bank-soal-container">
    <!-- Header Section -->
    <div class="bank-soal-header">
      <h1>Bank Soal ICT Laboratory</h1>
      <p>Koleksi lengkap soal-soal mata kuliah ICT untuk meningkatkan pemahaman dan kemampuan Anda dalam bidang teknologi informasi</p>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter-section">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="Cari mata kuliah..." />
      </div>
      
      <div class="filter-section">
        <div class="filter-item">
          <label for="mataKuliahFilter">Mata Kuliah:</label>
          <select id="mataKuliahFilter">
            <option value="">Semua Mata Kuliah</option>
            <option value="PENGANTAR IOT">PENGANTAR IOT</option>
            <option value="KEWARGANEGARAAN">KEWARGANEGARAAN</option>
            <option value="BASIS DATA">BASIS DATA</option>
            <option value="PROBABILITAS DAN STATISTIKA">PROBABILITAS DAN STATISTIKA</option>
            <option value="MATEMATIKA LANJUT">MATEMATIKA LANJUT</option>
            <option value="PENGANTAR SAINS KOMPUTER">PENGANTAR SAINS KOMPUTER</option>
            <option value="ALGORITMA LANJUT">ALGORITMA LANJUT</option>
            <option value="ALGORITMA DASAR">ALGORITMA DASAR</option>
            <option value="PENGANTAR SAINS DATA">PENGANTAR SAINS DATA</option>
            <option value="MATEMATIKA">MATEMATIKA</option>
            <option value="ORGANISASI DAN ARSITEKTUR KOMPUTER">ORGANISASI DAN ARSITEKTUR KOMPUTER</option>
            <option value="MATEMATIKA KOMPUTER">MATEMATIKA KOMPUTER</option>
            <option value="PENGANTAR TRANSFORMASI DIGITAL">PENGANTAR TRANSFORMASI DIGITAL</option>
            <option value="GRAFIKA KOMPUTER TERAPAN">GRAFIKA KOMPUTER TERAPAN</option>
            <option value="PEMROGRAMAN BERORIENTASI OBJEK">PEMROGRAMAN BERORIENTASI OBJEK</option>
            <option value="INTERAKSI MANUSIA DAN KOMPUTER">INTERAKSI MANUSIA DAN KOMPUTER</option>
            <option value="JARINGAN KOMPUTER">JARINGAN KOMPUTER</option>
            <option value="PEMROGRAMAN BASIS DATA">PEMROGRAMAN BASIS DATA</option>
            <option value="KOMPUTASI PARALEL & SISTEM TERDISTRIBUSI">KOMPUTASI PARALEL & SISTEM TERDISTRIBUSI</option>
            <option value="PEMROGRAMAN DASAR">PEMROGRAMAN DASAR</option>
            <option value="PENGOLAHAN CITRA DIGITAL">PENGOLAHAN CITRA DIGITAL</option>
            <option value="SISTEM OPERASI">SISTEM OPERASI</option>
            <option value="PEMROGRAMAN WEB LANJUT">PEMROGRAMAN WEB LANJUT</option>
            <option value="PEMROGRAMAN WEB">PEMROGRAMAN WEB</option>
            <option value="REKAYASA PERANGKAT LUNAK">REKAYASA PERANGKAT LUNAK</option>
            <option value="COMPUTER VISION">COMPUTER VISION</option>
            <option value="KEAMANAN JARINGAN">KEAMANAN JARINGAN</option>
            <option value="TEKNIK MULTIMEDIA">TEKNIK MULTIMEDIA</option>
            <option value="SISTEM PAKAR DAN BAHASA ALAMIAH">SISTEM PAKAR DAN BAHASA ALAMIAH</option>
            <option value="KECERDASAN BUATAN">KECERDASAN BUATAN</option>
            <option value="PENGENALAN UCAPAN DAN TEKS KE UCAPAN">PENGENALAN UCAPAN DAN TEKS KE UCAPAN</option>
            <option value="DATA MINING DAN INFORMATION RETRIEVAL">DATA MINING DAN INFORMATION RETRIEVAL</option>
            <option value="PEMROGRAMAN ROBOTIKA">PEMROGRAMAN ROBOTIKA</option>
            <option value="PEMROGRAMAN IOT">PEMROGRAMAN IOT</option>
            <option value="MACHINE LEARNING">MACHINE LEARNING</option>
            <option value="BAHASA INGGRIS I">BAHASA INGGRIS I</option>
            <option value="PEMROGRAMAN GAME">PEMROGRAMAN GAME</option>
            <option value="JARINGAN SYARAF TIRUAN">JARINGAN SYARAF TIRUAN</option>
            <option value="TRANSAKSI ELEKTRONIK">TRANSAKSI ELEKTRONIK</option>
            <option value="BASIS DATA LANJUT">BASIS DATA LANJUT</option>
            <option value="BISNIS INTELIJEN">BISNIS INTELIJEN</option>
            <option value="PEMROGRAMAN MOBILE">PEMROGRAMAN MOBILE</option>
            <option value="SISTEM OPERASI LANJUT">SISTEM OPERASI LANJUT</option>
            <option value="BAHASA INGGRIS III">BAHASA INGGRIS III</option>
            <option value="BAHASA INDONESIA">BAHASA INDONESIA</option>
            <option value="AGAMA">AGAMA</option>
            <option value="BAHASA INGGRIS II">BAHASA INGGRIS II</option>
            <option value="KEWIRAUSAHAAN">KEWIRAUSAHAAN</option>
            <option value="BIG DATA">BIG DATA</option>
            <option value="KOMPUTASI AWAN">KOMPUTASI AWAN</option>
            <option value="JARINGAN KOMPUTER LANJUT">JARINGAN KOMPUTER LANJUT</option>
            <option value="DEEP LEARNING">DEEP LEARNING</option>
          </select>
        </div>
        
        <div class="filter-item">
          <label for="tahunFilter">Tahun:</label>
          <select id="tahunFilter">
            <option value="">Semua Tahun</option>
            <option value="2024">2024</option>
            <option value="2023">2023</option>
            <option value="2022">2022</option>
          </select>
        </div>
        
        <div class="filter-item">
          <label for="ujianFilter">Jenis Ujian:</label>
          <select id="ujianFilter">
            <option value="">Semua Ujian</option>
            <option value="UTS">UTS</option>
            <option value="UAS">UAS</option>
          </select>
        </div>
        
        <button class="reset-filter-btn" onclick="resetFilters()">
          <i class="fas fa-refresh"></i> Reset
        </button>
      </div>
    </div>

    <!-- Cards Section -->
    <div class="cards-section">
      <div class="cards-header">
        <h3><i class="fas fa-graduation-cap"></i> Mata Kuliah</h3>
        <div class="cards-stats">
          <span id="totalMataKuliahCount">Total: 0 mata kuliah</span>
        </div>
      </div>
      
      <div class="cards-container" id="cardsContainer">
        <!-- Data will be loaded here -->
      </div>
      
      <!-- Pagination Section -->
      <div class="pagination-section" id="paginationSection" style="display: none;">
        <div class="pagination-info">
          <span class="pagination-info">Menampilkan 1-12 dari 48 mata kuliah</span>
        </div>
        <div class="pagination-controls">
          <button class="pagination-btn pagination-prev" onclick="prevPage()" disabled>
            <i class="fas fa-chevron-left"></i> Sebelumnya
          </button>
          <div class="pagination-numbers">
            <!-- Page numbers will be generated here -->
          </div>
          <button class="pagination-btn pagination-next" onclick="nextPage()">
            Selanjutnya <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Preview Modal -->
  <div class="preview-modal" id="previewModal">
    <div class="preview-modal-content">
      <div class="preview-header">
        <h3 id="previewTitle">Preview Soal</h3>
        <button class="close-preview" onclick="closePreview()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="preview-body">
        <img id="previewImage" src="" alt="Preview Soal" />
      </div>
      <div class="preview-footer">
        <button class="download-btn" onclick="downloadSoal()">
          <i class="fas fa-download"></i> Download
        </button>
      </div>
    </div>
  </div>

  <script>
    // Initialize login manager
    let loginManager;
    let currentPreviewData = null;

    // Soal data with exam files
    const soalData = [
      // Semester 1 & 2
      { id: 1, kode: "IFB-102", mataKuliah: "PENGANTAR IOT", tahun: "2023", jenisUjian: "UTS", fileName: "IFB102_PengantarIOT_23_UTS.webp" },
      { id: 2, kode: "IFB-102", mataKuliah: "PENGANTAR IOT", tahun: "2023", jenisUjian: "UAS", fileName: "IFB102_PengantarIOT_23_UAS.webp" },
      { id: 3, kode: "IFB-103", mataKuliah: "KEWARGANEGARAAN", tahun: "2023", jenisUjian: "UTS", fileName: "IFB103_Kewarganegaraan_23_UTS.webp" },
      { id: 4, kode: "IFB-103", mataKuliah: "KEWARGANEGARAAN", tahun: "2024", jenisUjian: "UAS", fileName: "IFB103_Kewarganegaraan_24_UAS.webp" },
      { id: 5, kode: "IFB-104", mataKuliah: "BASIS DATA", tahun: "2023", jenisUjian: "UTS", fileName: "IFB104_BasisData_23_UTS.webp" },
      { id: 6, kode: "IFB-104", mataKuliah: "BASIS DATA", tahun: "2024", jenisUjian: "UAS", fileName: "IFB104_BasisData_24_UAS.webp" },
      { id: 7, kode: "IFB-105", mataKuliah: "PROBABILITAS DAN STATISTIKA", tahun: "2023", jenisUjian: "UTS", fileName: "IFB105_ProbabilitasStatistika_23_UTS.webp" },
      { id: 8, kode: "IFB-106", mataKuliah: "MATEMATIKA LANJUT", tahun: "2024", jenisUjian: "UTS", fileName: "IFB106_MatematikaLanjut_24_UTS.webp" },
      { id: 9, kode: "IFB-107", mataKuliah: "PENGANTAR SAINS KOMPUTER", tahun: "2023", jenisUjian: "UAS", fileName: "IFB107_PengantarSainsKomputer_23_UAS.webp" },
      { id: 10, kode: "IFB-108", mataKuliah: "ALGORITMA LANJUT", tahun: "2024", jenisUjian: "UTS", fileName: "IFB108_AlgoritmaLanjut_24_UTS.webp" },
      { id: 11, kode: "IFB-109", mataKuliah: "ALGORITMA DASAR", tahun: "2023", jenisUjian: "UTS", fileName: "IFB109_AlgoritmaDasar_23_UTS.webp" },
      { id: 12, kode: "IFB-109", mataKuliah: "ALGORITMA DASAR", tahun: "2024", jenisUjian: "UAS", fileName: "IFB109_AlgoritmaDasar_24_UAS.webp" },
      { id: 13, kode: "IFB-110", mataKuliah: "PENGANTAR SAINS DATA", tahun: "2024", jenisUjian: "UTS", fileName: "IFB110_PengantarSainsData_24_UTS.webp" },
      { id: 14, kode: "IFB-111", mataKuliah: "MATEMATIKA", tahun: "2023", jenisUjian: "UAS", fileName: "IFB111_Matematika_23_UAS.webp" },
      { id: 15, kode: "IFB-112", mataKuliah: "ORGANISASI DAN ARSITEKTUR KOMPUTER", tahun: "2024", jenisUjian: "UTS", fileName: "IFB112_OrganisasiArsitekturKomputer_24_UTS.webp" },
      
      // Semester 3 & 4
      { id: 16, kode: "IFB-201", mataKuliah: "GRAFIKA KOMPUTER TERAPAN", tahun: "2023", jenisUjian: "UTS", fileName: "IFB201_GrafikaKomputerTerapan_23_UTS.webp" },
      { id: 17, kode: "IFB-202", mataKuliah: "PEMROGRAMAN BERORIENTASI OBJEK", tahun: "2024", jenisUjian: "UAS", fileName: "IFB202_PBO_24_UAS.webp" },
      { id: 18, kode: "IFB-203", mataKuliah: "INTERAKSI MANUSIA DAN KOMPUTER", tahun: "2023", jenisUjian: "UTS", fileName: "IFB203_IMK_23_UTS.webp" },
      { id: 19, kode: "IFB-204", mataKuliah: "JARINGAN KOMPUTER", tahun: "2024", jenisUjian: "UTS", fileName: "IFB204_JaringanKomputer_24_UTS.webp" },
      { id: 20, kode: "IFB-205", mataKuliah: "PEMROGRAMAN BASIS DATA", tahun: "2023", jenisUjian: "UAS", fileName: "IFB205_PemrogramanBasisData_23_UAS.webp" },
      { id: 21, kode: "IFB-206", mataKuliah: "KOMPUTASI PARALEL & SISTEM TERDISTRIBUSI", tahun: "2024", jenisUjian: "UTS", fileName: "IFB206_KomputasiParalel_24_UTS.webp" },
      { id: 22, kode: "IFB-207", mataKuliah: "PEMROGRAMAN DASAR", tahun: "2023", jenisUjian: "UTS", fileName: "IFB207_PemrogramanDasar_23_UTS.webp" },
      { id: 23, kode: "IFB-208", mataKuliah: "PENGOLAHAN CITRA DIGITAL", tahun: "2024", jenisUjian: "UAS", fileName: "IFB208_PengolahanCitra_24_UAS.webp" },
      { id: 24, kode: "IFB-209", mataKuliah: "SISTEM OPERASI", tahun: "2023", jenisUjian: "UTS", fileName: "IFB209_SistemOperasi_23_UTS.webp" },
      { id: 25, kode: "IFB-210", mataKuliah: "PEMROGRAMAN WEB LANJUT", tahun: "2024", jenisUjian: "UAS", fileName: "IFB210_PemrogramanWebLanjut_24_UAS.webp" },
      
      // Semester 5 & 6
      { id: 26, kode: "IFB-301", mataKuliah: "COMPUTER VISION", tahun: "2023", jenisUjian: "UTS", fileName: "IFB301_ComputerVision_23_UTS.webp" },
      { id: 27, kode: "IFB-302", mataKuliah: "KEAMANAN JARINGAN", tahun: "2024", jenisUjian: "UAS", fileName: "IFB302_KeamananJaringan_24_UAS.webp" },
      { id: 28, kode: "IFB-303", mataKuliah: "TEKNIK MULTIMEDIA", tahun: "2023", jenisUjian: "UTS", fileName: "IFB303_TeknikMultimedia_23_UTS.webp" },
      { id: 29, kode: "IFB-304", mataKuliah: "SISTEM PAKAR DAN BAHASA ALAMIAH", tahun: "2024", jenisUjian: "UTS", fileName: "IFB304_SistemPakar_24_UTS.webp" },
      { id: 30, kode: "IFB-305", mataKuliah: "KECERDASAN BUATAN", tahun: "2023", jenisUjian: "UAS", fileName: "IFB305_KecerdasanBuatan_23_UAS.webp" },
      { id: 31, kode: "IFB-307", mataKuliah: "DATA MINING DAN INFORMATION RETRIEVAL", tahun: "2024", jenisUjian: "UTS", fileName: "IFB307_DataMining_24_UTS.webp" },
      { id: 32, kode: "IFB-308", mataKuliah: "PEMROGRAMAN ROBOTIKA", tahun: "2023", jenisUjian: "UAS", fileName: "IFB308_PemrogramanRobotika_23_UAS.webp" },
      { id: 33, kode: "IFB-309", mataKuliah: "PEMROGRAMAN IOT", tahun: "2024", jenisUjian: "UTS", fileName: "IFB309_PemrogramanIOT_24_UTS.webp" },
      { id: 34, kode: "IFB-310", mataKuliah: "MACHINE LEARNING", tahun: "2023", jenisUjian: "UAS", fileName: "IFB310_MachineLearning_23_UAS.webp" },
      { id: 35, kode: "IFB-312", mataKuliah: "PEMROGRAMAN GAME", tahun: "2024", jenisUjian: "UTS", fileName: "IFB312_PemrogramanGame_24_UTS.webp" },
      
      // Semester 7 & 8
      { id: 36, kode: "IFB-351", mataKuliah: "JARINGAN SYARAF TIRUAN", tahun: "2023", jenisUjian: "UTS", fileName: "IFB351_JaringanSyarafTiruan_23_UTS.webp" },
      { id: 37, kode: "IFB-353", mataKuliah: "BASIS DATA LANJUT", tahun: "2024", jenisUjian: "UAS", fileName: "IFB353_BasisDataLanjut_24_UAS.webp" },
      { id: 38, kode: "IFB-355", mataKuliah: "PEMROGRAMAN MOBILE", tahun: "2023", jenisUjian: "UTS", fileName: "IFB355_PemrogramanMobile_23_UTS.webp" },
      { id: 39, kode: "IFB-451", mataKuliah: "BIG DATA", tahun: "2024", jenisUjian: "UAS", fileName: "IFB451_BigData_24_UAS.webp" },
      { id: 40, kode: "IFB-452", mataKuliah: "KOMPUTASI AWAN", tahun: "2023", jenisUjian: "UTS", fileName: "IFB452_KomputasiAwan_23_UTS.webp" },
      { id: 41, kode: "IFB-453", mataKuliah: "JARINGAN KOMPUTER LANJUT", tahun: "2024", jenisUjian: "UAS", fileName: "IFB453_JaringanKomputerLanjut_24_UAS.webp" },
      { id: 42, kode: "IFB-454", mataKuliah: "DEEP LEARNING", tahun: "2023", jenisUjian: "UTS", fileName: "IFB454_DeepLearning_23_UTS.webp" },
      
      // Mata Kuliah Umum
      { id: 43, kode: "IFB-311", mataKuliah: "BAHASA INGGRIS I", tahun: "2023", jenisUjian: "UAS", fileName: "IFB311_BahasaInggrisI_23_UAS.webp" },
      { id: 44, kode: "IFB-407", mataKuliah: "BAHASA INGGRIS II", tahun: "2024", jenisUjian: "UTS", fileName: "IFB407_BahasaInggrisII_24_UTS.webp" },
      { id: 45, kode: "IFB-402", mataKuliah: "BAHASA INGGRIS III", tahun: "2023", jenisUjian: "UAS", fileName: "IFB402_BahasaInggrisIII_23_UAS.webp" },
      { id: 46, kode: "IFB-404", mataKuliah: "BAHASA INDONESIA", tahun: "2024", jenisUjian: "UTS", fileName: "IFB404_BahasaIndonesia_24_UTS.webp" },
      { id: 47, kode: "IFB-405", mataKuliah: "AGAMA", tahun: "2023", jenisUjian: "UAS", fileName: "IFB405_Agama_23_UAS.webp" },
      { id: 48, kode: "IFB-409", mataKuliah: "KEWIRAUSAHAAN", tahun: "2024", jenisUjian: "UTS", fileName: "IFB409_Kewirausahaan_24_UTS.webp" }
    ];

    // Pagination variables
    let allSoal = [...soalData];
    let currentPage = 1;
    const itemsPerPage = 12;
    let filteredSoal = [...soalData];

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Bank Soal page loading...');
      
      // Add small delay to prevent redirect loops
      setTimeout(() => {
        // Check if user is logged in
        if (!isValidLogin()) {
          console.log('User not logged in or session expired, redirecting to login...');
          if (!document.body.classList.contains('redirecting')) {
            document.body.classList.add('redirecting');
            window.location.href = 'login.html';
          }
          return;
        }
        
        console.log('Valid login found, initializing page...');
        initializePage();
        displaySoalCardsWithPagination();
        setupEventListeners();
        
        // Additional check to ensure Login Manager updates the UI
        setTimeout(() => {
          console.log('Checking navbar update...');
          const catalogNavbar = document.querySelector('.catalog-navbar-menu');
          const loginLink = catalogNavbar ? catalogNavbar.querySelector('a[href="login.html"]') : null;
          
          console.log('Catalog navbar found:', !!catalogNavbar);
          console.log('Login link found:', !!loginLink);
          console.log('Login link content:', loginLink ? loginLink.innerHTML : 'N/A');
          
          if (isValidLogin()) {
            // Try to update via Login Manager first
            if (loginLink && loginLink.innerHTML === 'Login') {
              console.log('Manually updating navbar...');
              const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
              loginLink.innerHTML = `<i class="fas fa-user-circle"></i> ${userInfo.name || userInfo.given_name || 'User'}`;
              loginLink.href = '#';
              loginLink.onclick = (e) => {
                e.preventDefault();
                if (loginManager && loginManager.showUserMenu) {
                  loginManager.showUserMenu(e);
                } else {
                  // Fallback: show simple logout confirmation
                  showLogoutMenu(e);
                }
              };
            }
          }
        }, 500);
      }, 200);
    });

    // Setup event listeners for search and filters
    function setupEventListeners() {
      const searchInput = document.getElementById('searchInput');
      const mataKuliahFilter = document.getElementById('mataKuliahFilter');
      const tahunFilter = document.getElementById('tahunFilter');
      const ujianFilter = document.getElementById('ujianFilter');

      searchInput.addEventListener('input', filterAndDisplayCards);
      mataKuliahFilter.addEventListener('change', filterAndDisplayCards);
      tahunFilter.addEventListener('change', filterAndDisplayCards);
      ujianFilter.addEventListener('change', filterAndDisplayCards);
    }

    // Filter and display cards
    function filterAndDisplayCards() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const mataKuliah = document.getElementById('mataKuliahFilter').value;
      const tahun = document.getElementById('tahunFilter').value;
      const ujian = document.getElementById('ujianFilter').value;

      // Filter the raw data first
      filteredSoal = soalData.filter(item => {
        const matchSearch = item.mataKuliah.toLowerCase().includes(searchTerm);
        const matchMataKuliah = !mataKuliah || item.mataKuliah === mataKuliah;
        const matchTahun = !tahun || item.tahun === tahun;
        const matchUjian = !ujian || item.jenisUjian === ujian;
        
        return matchSearch && matchMataKuliah && matchTahun && matchUjian;
      });

      // Reset to first page when filtering
      currentPage = 1;
      
      // Display with pagination
      displaySoalCardsWithPagination();
    }

    // Pagination functions
    function renderPagination() {
      const totalPages = Math.ceil(filteredSoal.length / itemsPerPage);
      const paginationContainer = document.querySelector('.pagination-numbers');
      const pageInfo = document.querySelector('.pagination-info');
      
      // Update page info
      const start = (currentPage - 1) * itemsPerPage + 1;
      const end = Math.min(currentPage * itemsPerPage, filteredSoal.length);
      pageInfo.textContent = `Menampilkan ${start}-${end} dari ${filteredSoal.length} mata kuliah`;
      
      // Clear pagination numbers
      paginationContainer.innerHTML = '';
      
      // Calculate page range to show
      let startPage = Math.max(1, currentPage - 2);
      let endPage = Math.min(totalPages, currentPage + 2);
      
      // Adjust range if needed
      if (endPage - startPage < 4) {
        if (startPage === 1) {
          endPage = Math.min(totalPages, startPage + 4);
        } else if (endPage === totalPages) {
          startPage = Math.max(1, endPage - 4);
        }
      }
      
      // Add page numbers
      for (let i = startPage; i <= endPage; i++) {
        const pageBtn = document.createElement('button');
        pageBtn.className = `pagination-number ${i === currentPage ? 'active' : ''}`;
        pageBtn.textContent = i;
        pageBtn.onclick = () => goToPage(i);
        paginationContainer.appendChild(pageBtn);
      }
      
      // Update prev/next buttons
      document.querySelector('.pagination-prev').disabled = currentPage === 1;
      document.querySelector('.pagination-next').disabled = currentPage === totalPages;
      
      // Hide pagination if only one page
      document.querySelector('.pagination-section').style.display = 
        totalPages <= 1 ? 'none' : 'flex';
    }

    function goToPage(page) {
      currentPage = page;
      displaySoalCardsWithPagination();
      renderPagination();
      
      // Scroll to top of results
      document.querySelector('.results-section').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
    }

    function nextPage() {
      const totalPages = Math.ceil(filteredSoal.length / itemsPerPage);
      if (currentPage < totalPages) {
        goToPage(currentPage + 1);
      }
    }

    function prevPage() {
      if (currentPage > 1) {
        goToPage(currentPage - 1);
      }
    }

    // Reset filters
    function resetFilters() {
      document.getElementById('searchInput').value = '';
      document.getElementById('mataKuliahFilter').value = '';
      document.getElementById('tahunFilter').value = '';
      document.getElementById('ujianFilter').value = '';
      
      // Reset filtered data and pagination
      filteredSoal = [...soalData];
      currentPage = 1;
      
      displaySoalCardsWithPagination();
    }

    // Display soal cards with pagination
    function displaySoalCardsWithPagination(filteredGroups = null) {
      const cardsContainer = document.getElementById('cardsContainer');
      const totalCount = document.getElementById('totalMataKuliahCount');
      
      // Group data by mata kuliah if not already filtered
      let groupedData = filteredGroups;
      if (!groupedData) {
        groupedData = {};
        filteredSoal.forEach(item => {
          if (!groupedData[item.mataKuliah]) {
            groupedData[item.mataKuliah] = [];
          }
          groupedData[item.mataKuliah].push(item);
        });
      }
      
      const allMataKuliah = Object.keys(groupedData);
      const totalMataKuliah = allMataKuliah.length;
      
      // Calculate pagination
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = startIndex + itemsPerPage;
      const paginatedMataKuliah = allMataKuliah.slice(startIndex, endIndex);
      
      totalCount.textContent = `Total: ${totalMataKuliah} mata kuliah`;

      if (totalMataKuliah === 0) {
        cardsContainer.innerHTML = `
          <div class="no-soal-message">
            <i class="fas fa-search"></i>
            <h4>Tidak ada mata kuliah yang ditemukan</h4>
            <p>Coba ubah filter atau kata kunci pencarian</p>
          </div>
        `;
        document.querySelector('.pagination-section').style.display = 'none';
        return;
      }

      // Generate cards HTML for current page only
      cardsContainer.innerHTML = paginatedMataKuliah.map(mataKuliah => {
        const items = groupedData[mataKuliah];
        const availableYears = [...new Set(items.map(item => item.tahun))].sort();
        const availableUjian = [...new Set(items.map(item => item.jenisUjian))];
        
        // Get icons for different subjects
        const getSubjectIcon = (subject) => {
          const iconMap = {
            'PENGANTAR IOT': 'fas fa-microchip',
            'KEWARGANEGARAAN': 'fas fa-flag',
            'BASIS DATA': 'fas fa-database',
            'PEMROGRAMAN WEB': 'fas fa-globe',
            'ALGORITMA & PEMROGRAMAN': 'fas fa-code',
            'MATEMATIKA DISKRIT': 'fas fa-calculator',
            'STATISTIKA': 'fas fa-chart-bar',
            'FISIKA': 'fas fa-atom',
            'STRUKTUR DATA': 'fas fa-project-diagram',
            'JARINGAN KOMPUTER': 'fas fa-network-wired',
            'SISTEM OPERASI': 'fas fa-desktop',
            'REKAYASA PERANGKAT LUNAK': 'fas fa-cogs',
            'KEAMANAN INFORMASI': 'fas fa-shield-alt',
            'BAHASA INGGRIS I': 'fas fa-language',
            'BAHASA INGGRIS II': 'fas fa-language',
            'BAHASA INGGRIS III': 'fas fa-language',
            'BAHASA INDONESIA': 'fas fa-book-open',
            'AGAMA': 'fas fa-pray',
            'KEWIRAUSAHAAN': 'fas fa-handshake'
          };
          return iconMap[subject] || 'fas fa-book';
        };

        return `
          <div class="soal-card" data-mata-kuliah="${mataKuliah}">
            <div class="card-header">
              <div class="card-icon">
                <i class="${getSubjectIcon(mataKuliah)}"></i>
              </div>
              <div class="card-title">
                <h4>${mataKuliah}</h4>
                <p class="card-subtitle">${items.length} soal tersedia</p>
              </div>
            </div>
            
            <div class="card-selectors">
              <div class="selector-group">
                <label>Tahun:</label>
                <select class="year-selector" onchange="updateCardActions('${mataKuliah}')">
                  <option value="">Pilih Tahun</option>
                  ${availableYears.map(year => `<option value="${year}">${year}</option>`).join('')}
                </select>
              </div>
              
              <div class="selector-group">
                <label>Jenis Ujian:</label>
                <select class="ujian-selector" onchange="updateCardActions('${mataKuliah}')">
                  <option value="">Pilih Ujian</option>
                  ${availableUjian.map(ujian => `<option value="${ujian}">${ujian}</option>`).join('')}
                </select>
              </div>
            </div>
            
            <div class="card-actions">
              <button class="card-preview-btn" onclick="previewFromCard('${mataKuliah}')" disabled>
                <i class="fas fa-eye"></i> Preview
              </button>
              <button class="card-download-btn" onclick="downloadFromCard('${mataKuliah}')" disabled>
                <i class="fas fa-download"></i> Download
              </button>
            </div>
          </div>
        `;
      }).join('');
      
      // Render pagination
      renderPagination();
    }

    // Display soal cards
    function displaySoalCards(filteredGroups = null) {
      const cardsContainer = document.getElementById('cardsContainer');
      const totalCount = document.getElementById('totalMataKuliahCount');
      
      // Group data by mata kuliah if not already filtered
      let groupedData = filteredGroups;
      if (!groupedData) {
        groupedData = {};
        soalData.forEach(item => {
          if (!groupedData[item.mataKuliah]) {
            groupedData[item.mataKuliah] = [];
          }
          groupedData[item.mataKuliah].push(item);
        });
      }
      
      const mataKuliahCount = Object.keys(groupedData).length;
      totalCount.textContent = `Total: ${mataKuliahCount} mata kuliah`;

      if (mataKuliahCount === 0) {
        cardsContainer.innerHTML = `
          <div class="no-soal-message">
            <i class="fas fa-search"></i>
            <h4>Tidak ada mata kuliah yang ditemukan</h4>
            <p>Coba ubah filter atau kata kunci pencarian</p>
          </div>
        `;
        return;
      }

      // Generate cards HTML
      cardsContainer.innerHTML = Object.keys(groupedData).map(mataKuliah => {
        const items = groupedData[mataKuliah];
        const availableYears = [...new Set(items.map(item => item.tahun))].sort();
        const availableUjian = [...new Set(items.map(item => item.jenisUjian))];
        
        // Get icons for different subjects
        const getSubjectIcon = (subject) => {
          const iconMap = {
            'Pemrograman Lanjut': 'fas fa-code',
            'Struktur Data': 'fas fa-project-diagram',
            'Basis Data': 'fas fa-database',
            'Jaringan Komputer': 'fas fa-network-wired',
            'Sistem Operasi': 'fas fa-desktop',
            'Rekayasa Perangkat Lunak': 'fas fa-cogs',
            'Keamanan Informasi': 'fas fa-shield-alt'
          };
          return iconMap[subject] || 'fas fa-book';
        };

        return `
          <div class="soal-card" data-mata-kuliah="${mataKuliah}">
            <div class="card-header">
              <div class="card-icon">
                <i class="${getSubjectIcon(mataKuliah)}"></i>
              </div>
              <div class="card-title">
                <h4>${mataKuliah}</h4>
                <p class="card-subtitle">${items.length} soal tersedia</p>
              </div>
            </div>
            
            <div class="card-selectors">
              <div class="selector-group">
                <label>Tahun:</label>
                <select class="year-selector" onchange="updateCardActions('${mataKuliah}')">
                  <option value="">Pilih Tahun</option>
                  ${availableYears.map(year => `<option value="${year}">${year}</option>`).join('')}
                </select>
              </div>
              
              <div class="selector-group">
                <label>Jenis Ujian:</label>
                <select class="ujian-selector" onchange="updateCardActions('${mataKuliah}')">
                  <option value="">Pilih Ujian</option>
                  ${availableUjian.map(ujian => `<option value="${ujian}">${ujian}</option>`).join('')}
                </select>
              </div>
            </div>
            
            <div class="card-actions">
              <button class="card-preview-btn" onclick="previewFromCard('${mataKuliah}')" disabled>
                <i class="fas fa-eye"></i> Preview
              </button>
              <button class="card-download-btn" onclick="downloadFromCard('${mataKuliah}')" disabled>
                <i class="fas fa-download"></i> Download
              </button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Update card actions based on selections
    function updateCardActions(mataKuliah) {
      const card = document.querySelector(`[data-mata-kuliah="${mataKuliah}"]`);
      if (!card) return;

      const yearSelector = card.querySelector('.year-selector');
      const ujianSelector = card.querySelector('.ujian-selector');
      const previewBtn = card.querySelector('.card-preview-btn');
      const downloadBtn = card.querySelector('.card-download-btn');

      const selectedYear = yearSelector.value;
      const selectedUjian = ujianSelector.value;

      // Enable/disable buttons based on selections
      const bothSelected = selectedYear && selectedUjian;
      previewBtn.disabled = !bothSelected;
      downloadBtn.disabled = !bothSelected;

      // Reset button opacity when selection changes
      if (bothSelected) {
        previewBtn.style.opacity = '1';
        downloadBtn.style.opacity = '1';
      }
    }

    // Preview from card
    function previewFromCard(mataKuliah) {
      const card = document.querySelector(`[data-mata-kuliah="${mataKuliah}"]`);
      if (!card) return;

      const yearSelector = card.querySelector('.year-selector');
      const ujianSelector = card.querySelector('.ujian-selector');
      const selectedYear = yearSelector.value;
      const selectedUjian = ujianSelector.value;

      if (!selectedYear || !selectedUjian) {
        Swal.fire({
          title: 'Pilih Tahun dan Jenis Ujian',
          text: 'Mohon pilih tahun dan jenis ujian terlebih dahulu',
          icon: 'warning',
          confirmButtonText: 'OK',
          confirmButtonColor: '#f39c12',
          customClass: {
            popup: 'swal-popup',
            title: 'swal-title',
            content: 'swal-content'
          }
        });
        return;
      }

      // Find the specific soal item
      const soalItem = soalData.find(item => 
        item.mataKuliah === mataKuliah && 
        item.tahun === selectedYear && 
        item.jenisUjian === selectedUjian
      );

      if (soalItem) {
        previewSoal(soalItem.id);
      }
    }

    // Download from card
    function downloadFromCard(mataKuliah) {
      const card = document.querySelector(`[data-mata-kuliah="${mataKuliah}"]`);
      if (!card) return;

      const yearSelector = card.querySelector('.year-selector');
      const ujianSelector = card.querySelector('.ujian-selector');
      const selectedYear = yearSelector.value;
      const selectedUjian = ujianSelector.value;

      if (!selectedYear || !selectedUjian) {
        Swal.fire({
          title: 'Pilih Tahun dan Jenis Ujian',
          text: 'Mohon pilih tahun dan jenis ujian terlebih dahulu',
          icon: 'warning',
          confirmButtonText: 'OK',
          confirmButtonColor: '#f39c12',
          customClass: {
            popup: 'swal-popup',
            title: 'swal-title',
            content: 'swal-content'
          }
        });
        return;
      }

      // Find the specific soal item
      const soalItem = soalData.find(item => 
        item.mataKuliah === mataKuliah && 
        item.tahun === selectedYear && 
        item.jenisUjian === selectedUjian
      );

      if (soalItem) {
        downloadSoalFile(soalItem.fileName);
      }
    }

    // Preview soal function
    function previewSoal(soalId) {
      const soal = soalData.find(item => item.id === soalId);
      if (!soal) return;

      currentPreviewData = soal;
      
      // Set modal content
      document.getElementById('previewTitle').textContent = `${soal.mataKuliah} - ${soal.jenisUjian} ${soal.tahun}`;
      
      const previewImage = document.getElementById('previewImage');
      const imageUrl = `img/soal/${soal.fileName}`;
      
      // Hide any existing unavailable message
      const messageDiv = document.getElementById('unavailableMessage');
      if (messageDiv) {
        messageDiv.style.display = 'none';
      }
      
      // Show image initially
      previewImage.style.display = 'block';
      previewImage.src = imageUrl;
      
      // Handle image load error
      previewImage.onerror = function() {
        // Hide image and show "soal belum tersedia" message
        this.style.display = 'none';
        
        // Create or update message
        let messageDiv = document.getElementById('unavailableMessage');
        if (!messageDiv) {
          messageDiv = document.createElement('div');
          messageDiv.id = 'unavailableMessage';
          messageDiv.style.cssText = `
            padding: 60px 20px;
            text-align: center;
            color: #999;
            font-size: 1.2rem;
            font-family: 'Inter', sans-serif;
          `;
          this.parentNode.appendChild(messageDiv);
        }
        messageDiv.innerHTML = `
          <i class="fas fa-file-alt" style="font-size: 3rem; margin-bottom: 20px; display: block; color: #ddd;"></i>
          <p style="margin: 0; font-weight: 500;">Soal belum tersedia</p>
          <p style="margin: 10px 0 0; font-size: 0.9rem;">File soal untuk mata kuliah ini belum diupload</p>
        `;
        messageDiv.style.display = 'block';
      };
      
      // Handle successful image load
      previewImage.onload = function() {
        this.style.display = 'block';
        const messageDiv = document.getElementById('unavailableMessage');
        if (messageDiv) {
          messageDiv.style.display = 'none';
        }
      };
      
      // Show modal
      document.getElementById('previewModal').style.display = 'block';
    }

    // Close preview modal
    function closePreview() {
      document.getElementById('previewModal').style.display = 'none';
      currentPreviewData = null;
    }

    // Download soal function
    function downloadSoal() {
      if (currentPreviewData) {
        downloadSoalFile(currentPreviewData.fileName);
      }
    }

    function downloadSoalFile(fileName) {
      // Check if file exists by trying to create the download link
      const imageUrl = `img/soal/${fileName}`;
      
      // Create a temporary image to check if file exists
      const testImage = new Image();
      
      testImage.onload = function() {
        // File exists, proceed with download
        const link = document.createElement('a');
        link.href = imageUrl;
        link.download = fileName;
        link.style.display = 'none';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Show success message
        Swal.fire({
          title: 'Download Berhasil!',
          text: `File ${fileName} sedang didownload`,
          icon: 'success',
          timer: 2000,
          showConfirmButton: false,
          customClass: {
            popup: 'swal-popup',
            title: 'swal-title',
            content: 'swal-content'
          }
        });
      };
      
      testImage.onerror = function() {
        // File doesn't exist, show alert
        Swal.fire({
          title: 'Soal Belum Tersedia',
          text: 'Maaf, soal untuk mata kuliah ini belum tersedia untuk didownload',
          icon: 'warning',
          confirmButtonText: 'OK',
          confirmButtonColor: '#f39c12',
          customClass: {
            popup: 'swal-popup',
            title: 'swal-title',
            content: 'swal-content'
          }
        });
      };
      
      // Start checking if image exists
      testImage.src = imageUrl;
    }

    // Close modal when clicking outside
    document.addEventListener('click', function(e) {
      const modal = document.getElementById('previewModal');
      if (e.target === modal) {
        closePreview();
      }
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closePreview();
      }
    });

    // Fallback logout menu function
    function showLogoutMenu(event) {
      // Remove existing menu if any
      const existingMenu = document.querySelector('.simple-logout-menu');
      if (existingMenu) {
        existingMenu.remove();
      }

      const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
      const userEmail = localStorage.getItem('userEmail') || '';
      
      // Create simple logout menu
      const menu = document.createElement('div');
      menu.className = 'simple-logout-menu';
      menu.innerHTML = `
        <div class="user-info">
          <img src="${userInfo?.picture || 'img/logo-bg.png'}" alt="Profile" class="user-avatar">
          <div class="user-details">
            <div class="user-name">${userInfo?.name || userInfo?.given_name || 'User'}</div>
            <div class="user-email">${userEmail}</div>
            <div class="login-method">Via Google</div>
          </div>
        </div>
        <div class="menu-divider"></div>
        <button class="menu-item" onclick="performLogout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      `;

      // Position menu
      const rect = event.target.getBoundingClientRect();
      menu.style.position = 'fixed';
      menu.style.top = (rect.bottom + 10) + 'px';
      menu.style.right = (window.innerWidth - rect.right) + 'px';
      menu.style.zIndex = '10000';

      document.body.appendChild(menu);

      // Close menu when clicking outside
      setTimeout(() => {
        document.addEventListener('click', function closeMenu(e) {
          if (!menu.contains(e.target) && e.target !== event.target) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        });
      }, 100);
    }

    // Logout function
    function performLogout() {
      Swal.fire({
        title: 'Konfirmasi Logout',
        text: 'Apakah Anda yakin ingin logout?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Ya, Logout',
        cancelButtonText: 'Batal',
        background: '#fff',
        customClass: {
          popup: 'swal-popup',
          title: 'swal-title',
          content: 'swal-content'
        }
      }).then((result) => {
        if (result.isConfirmed) {
          console.log('User logging out...');
          
          // Show loading alert
          Swal.fire({
            title: 'Logging out...',
            text: 'Mohon tunggu sebentar',
            icon: 'info',
            allowOutsideClick: false,
            showConfirmButton: false,
            didOpen: () => {
              Swal.showLoading();
            }
          });
          
          if (loginManager && loginManager.logout) {
            loginManager.logout();
          } else {
            // Fallback logout
            clearUserSession();
            
            if (!document.body.classList.contains('redirecting')) {
              document.body.classList.add('redirecting');
              setTimeout(() => {
                window.location.href = 'login.html';
              }, 500);
            }
          }
        }
      });
    }

    function isValidLogin() {
      const email = localStorage.getItem('userEmail');
      const isLoggedIn = localStorage.getItem('isLoggedIn');
      const loginTime = localStorage.getItem('loginTime');
      const sessionValid = localStorage.getItem('sessionValid');
      
      console.log('Checking login validity:', { 
        isLoggedIn, 
        email, 
        loginTime, 
        sessionValid,
        emailDomain: email ? email.split('@')[1] : 'none'
      });
      
      // Check basic login status
      if (isLoggedIn !== 'true' || !email || !email.endsWith('@mhs.itenas.ac.id') || sessionValid !== 'true') {
        console.log('Invalid login status, email domain, or session');
        return false;
      }
      
      // Check if login is not expired (24 hours)
      if (loginTime) {
        const loginDate = new Date(loginTime);
        const now = new Date();
        const hoursDiff = (now - loginDate) / (1000 * 60 * 60);
        
        console.log('Session age (hours):', hoursDiff.toFixed(2));
        
        if (hoursDiff > 24) {
          console.log('Login session expired (>24 hours)');
          // Clear expired session
          clearUserSession();
          return false;
        }
      }
      
      console.log('Login validation passed');
      return true;
    }

    function clearUserSession() {
      console.log('Clearing user session...');
      localStorage.removeItem('isLoggedIn');
      localStorage.removeItem('userInfo');
      localStorage.removeItem('userEmail');
      localStorage.removeItem('loginMethod');
      localStorage.removeItem('loginTime');
      localStorage.removeItem('lastActiveTime');
      localStorage.removeItem('sessionValid');
    }

    function initializePage() {
      console.log('Initializing Bank Soal ICT page...');
      
      // Initialize login manager with a small delay to ensure it's loaded
      setTimeout(() => {
        if (typeof LoginManager !== 'undefined') {
          loginManager = new LoginManager();
          console.log('Login Manager initialized');
          
          // Force update the navbar UI
          if (loginManager.updateLoginUI) {
            loginManager.updateLoginUI();
          }
        } else {
          console.warn('LoginManager class not available');
        }
      }, 100);
      
      // Load user info for display (optional)
      const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
      const email = localStorage.getItem('userEmail') || '';
      
      console.log('User info loaded:', { email, name: userInfo.name });
      
      // Update last active time
      localStorage.setItem('lastActiveTime', new Date().toISOString());
    }

    function initializePage() {
      console.log('Initializing Bank Soal ICT page...');
      
      // Initialize login manager with a small delay to ensure it's loaded
      setTimeout(() => {
        if (typeof LoginManager !== 'undefined') {
          loginManager = new LoginManager();
          console.log('Login Manager initialized');
          
          // Force update the navbar UI
          if (loginManager.updateLoginUI) {
            loginManager.updateLoginUI();
          }
        } else {
          console.warn('LoginManager class not available');
        }
      }, 100);
      
      // Load user info for display (optional)
      const userInfo = JSON.parse(localStorage.getItem('userInfo') || '{}');
      const email = localStorage.getItem('userEmail') || '';
      
      console.log('User info loaded:', { email, name: userInfo.name });
      
      // Update last active time
      localStorage.setItem('lastActiveTime', new Date().toISOString());
    }
  </script>
</body>

</html>
